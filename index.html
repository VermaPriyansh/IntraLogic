<!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refinery Drum Inspection Dashboard - DRUM-VES-01</title>
    <style>
      /* Design System CSS */
      :root {
    /* Primitive Color Tokens */
    --color-white: rgba(255, 255, 255, 1);
    --color-black: rgba(0, 0, 0, 1);
    --color-cream-50: rgba(252, 252, 249, 1);
    --color-cream-100: rgba(255, 255, 253, 1);
    --color-gray-200: rgba(245, 245, 245, 1);
    --color-gray-300: rgba(167, 169, 169, 1);
    --color-gray-400: rgba(119, 124, 124, 1);
    --color-slate-500: rgba(98, 108, 113, 1);
    --color-brown-600: rgba(94, 82, 64, 1);
    --color-charcoal-700: rgba(31, 33, 33, 1);
    --color-charcoal-800: rgba(38, 40, 40, 1);
    --color-slate-900: rgba(19, 52, 59, 1);
    --color-teal-300: rgba(50, 184, 198, 1);
    --color-teal-400: rgba(45, 166, 178, 1);
    --color-teal-500: rgba(33, 128, 141, 1);
    --color-teal-600: rgba(29, 116, 128, 1);
    --color-teal-700: rgba(26, 104, 115, 1);
    --color-teal-800: rgba(41, 150, 161, 1);
    --color-red-400: rgba(255, 84, 89, 1);
    --color-red-500: rgba(192, 21, 47, 1);
    --color-orange-400: rgba(230, 129, 97, 1);
    --color-yellow-500: rgba(234, 214, 55, 1);

    --color-brown-600-rgb: 94, 82, 64;
    --color-teal-500-rgb: 33, 128, 141;
    --color-primary-rgb: 33, 128, 141;
    --color-slate-900-rgb: 19, 52, 59;
    --color-slate-500-rgb: 98, 108, 113;
    --color-red-500-rgb: 192, 21, 47;
    --color-red-400-rgb: 255, 84, 89;
    --color-orange-500-rgb: 168, 75, 47;
    --color-orange-400-rgb: 230, 129, 97;

    --color-bg-1: rgba(59, 130, 246, 0.08);
    --color-bg-2: rgba(245, 158, 11, 0.08);
    --color-bg-3: rgba(34, 197, 94, 0.08);
    --color-bg-4: rgba(239, 68, 68, 0.08);
    --color-bg-5: rgba(147, 51, 234, 0.08);
    --color-bg-6: rgba(249, 115, 22, 0.08);
    --color-bg-7: rgba(236, 72, 153, 0.08);
    --color-bg-8: rgba(6, 182, 212, 0.08);

    --color-background: var(--color-cream-50);
    --color-surface: var(--color-cream-100);
    --color-text: var(--color-slate-900);
    --color-text-secondary: var(--color-slate-500);
    --color-primary: var(--color-teal-500);
    --color-primary-hover: var(--color-teal-600);
    --color-primary-active: var(--color-teal-700);
    --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
    --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
    --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
    --color-border: rgba(var(--color-brown-600-rgb), 0.2);
    --color-btn-primary-text: var(--color-cream-50);
    --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
    --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
    --color-error: var(--color-red-500);
    --color-success: var(--color-teal-500);
    --color-warning: var(--color-yellow-500);
    --color-info: var(--color-slate-500);
    --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
    --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);

    --focus-ring: 0 0 0 3px var(--color-focus-ring);
    --focus-outline: 2px solid var(--color-primary);
    --status-bg-opacity: 0.15;
    --status-border-opacity: 0.25;

    --color-success-rgb: 33, 128, 141;
    --color-error-rgb: 192, 21, 47;
    --color-warning-rgb: 168, 75, 47;
    --color-info-rgb: 98, 108, 113;

    --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    --font-family-mono: "Berkeley Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    --font-size-xs: 11px;
    --font-size-sm: 12px;
    --font-size-base: 14px;
    --font-size-md: 14px;
    --font-size-lg: 16px;
    --font-size-xl: 18px;
    --font-size-2xl: 20px;
    --font-size-3xl: 24px;
    --font-size-4xl: 30px;
    --font-weight-normal: 400;
    --font-weight-medium: 500;
    --font-weight-semibold: 550;
    --font-weight-bold: 600;
    --line-height-tight: 1.2;
    --line-height-normal: 1.5;
    --letter-spacing-tight: -0.01em;

    --space-0: 0;
    --space-1: 1px;
    --space-2: 2px;
    --space-4: 4px;
    --space-6: 6px;
    --space-8: 8px;
    --space-10: 10px;
    --space-12: 12px;
    --space-16: 16px;
    --space-20: 20px;
    --space-24: 24px;
    --space-32: 32px;

    --radius-sm: 6px;
    --radius-base: 8px;
    --radius-md: 10px;
    --radius-lg: 12px;
    --radius-full: 9999px;

    --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04), 0 4px 6px -2px rgba(0, 0, 0, 0.02);
    --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.15), inset 0 -1px 0 rgba(0, 0, 0, 0.03);

    --duration-fast: 150ms;
    --duration-normal: 250ms;
    --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);

    --container-sm: 640px;
    --container-md: 768px;
    --container-lg: 1024px;
    --container-xl: 1280px;
  }

  @media (prefers-color-scheme: dark) {
    :root {
      --color-gray-400-rgb: 119, 124, 124;
      --color-teal-300-rgb: 50, 184, 198;
      --color-gray-300-rgb: 167, 169, 169;
      --color-gray-200-rgb: 245, 245, 245;

      --color-bg-1: rgba(29, 78, 216, 0.15);
      --color-bg-2: rgba(180, 83, 9, 0.15);
      --color-bg-3: rgba(21, 128, 61, 0.15);
      --color-bg-4: rgba(185, 28, 28, 0.15);
      --color-bg-5: rgba(107, 33, 168, 0.15);
      --color-bg-6: rgba(194, 65, 12, 0.15);
      --color-bg-7: rgba(190, 24, 93, 0.15);
      --color-bg-8: rgba(8, 145, 178, 0.15);

      --color-background: var(--color-charcoal-700);
      --color-surface: var(--color-charcoal-800);
      --color-text: var(--color-gray-200);
      --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
      --color-primary: var(--color-teal-300);
      --color-primary-hover: var(--color-teal-400);
      --color-primary-active: var(--color-teal-800);
      --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
      --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
      --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
      --color-border: rgba(var(--color-gray-400-rgb), 0.3);
      --color-error: var(--color-red-400);
      --color-success: var(--color-teal-300);
      --color-warning: var(--color-orange-400);
      --color-info: var(--color-gray-300);
      --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
      --color-btn-primary-text: var(--color-slate-900);
      --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
      --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
      --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1), inset 0 -1px 0 rgba(0, 0, 0, 0.15);
      --color-select-caret: rgba(var(--color-gray-200-rgb), 0.8);

      --color-success-rgb: var(--color-teal-300-rgb);
      --color-error-rgb: var(--color-red-400-rgb);
      --color-warning-rgb: var(--color-orange-400-rgb);
      --color-info-rgb: var(--color-gray-300-rgb);
    }
  }

  @font-face {
    font-family: 'FKGroteskNeue';
    src: url('https://r2cdn.perplexity.ai/fonts/FKGroteskNeue.woff2') format('woff2');
  }

  html {
    font-size: var(--font-size-base);
    font-family: var(--font-family-base);
    line-height: var(--line-height-normal);
    color: var(--color-text);
    background-color: var(--color-background);
    -webkit-font-smoothing: antialiased;
    box-sizing: border-box;
  }

  body {
    margin: 0;
    padding: 0;
  }

  *, *::before, *::after {
    box-sizing: inherit;
  }

      /* Custom Application Styles */
      .dashboard-container {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      .dashboard-header {
        background: var(--color-surface);
        border-bottom: 1px solid var(--color-border);
        padding: var(--space-16) var(--space-24);
        box-shadow: var(--shadow-sm);
      }

      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1600px;
        margin: 0 auto;
      }

      .header-title {
        display: flex;
        flex-direction: column;
        gap: var(--space-4);
      }

      .header-title h1 {
        font-size: var(--font-size-2xl);
        font-weight: var(--font-weight-bold);
        margin: 0;
      }

      .breadcrumb {
        display: flex;
        align-items: center;
        gap: var(--space-8);
        font-size: var(--font-size-sm);
        color: var(--color-text-secondary);
      }

      .breadcrumb-item {
        cursor: pointer;
        transition: color var(--duration-fast);
      }

      .breadcrumb-item:hover {
        color: var(--color-primary);
      }

      .breadcrumb-separator {
        color: var(--color-text-secondary);
      }

      .breadcrumb-item.active {
        color: var(--color-text);
        cursor: default;
      }

      .header-actions {
        display: flex;
        gap: var(--space-12);
        align-items: center;
      }

      .btn {
        display: inline-flex;
        align-items: center;
        gap: var(--space-8);
        padding: var(--space-8) var(--space-16);
        border-radius: var(--radius-base);
        font-size: var(--font-size-sm);
        font-weight: var(--font-weight-medium);
        cursor: pointer;
        transition: all var(--duration-normal) var(--ease-standard);
        border: none;
        text-decoration: none;
      }

      .btn-primary {
        background: var(--color-primary);
        color: var(--color-btn-primary-text);
      }

      .btn-primary:hover {
        background: var(--color-primary-hover);
      }

      .btn-secondary {
        background: var(--color-secondary);
        color: var(--color-text);
      }

      .btn-secondary:hover {
        background: var(--color-secondary-hover);
      }

      .dashboard-main {
        display: flex;
        flex: 1;
        max-width: 1600px;
        margin: 0 auto;
        width: 100%;
        gap: var(--space-24);
        padding: var(--space-24);
      }

      .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: var(--space-24);
      }

      .metrics-panel {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: var(--space-16);
      }

      .metric-card {
        background: var(--color-surface);
        border: 1px solid var(--color-card-border);
        border-radius: var(--radius-lg);
        padding: var(--space-20);
        box-shadow: var(--shadow-sm);
      }

      .metric-label {
        font-size: var(--font-size-sm);
        color: var(--color-text-secondary);
        margin-bottom: var(--space-8);
      }

      .metric-value {
        font-size: var(--font-size-3xl);
        font-weight: var(--font-weight-bold);
        color: var(--color-text);
      }

      .metric-subtext {
        font-size: var(--font-size-xs);
        color: var(--color-text-secondary);
        margin-top: var(--space-4);
      }

      .column-visualization {
        background: var(--color-surface);
        border: 1px solid var(--color-card-border);
        border-radius: var(--radius-lg);
        padding: var(--space-24);
        box-shadow: var(--shadow-sm);
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        min-height: 700px;
      }

      .drum-container {
        position: relative;
        width: 100%;
        max-width: 400px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .drum-vessel {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 250px;
        position: relative;
      }

      .segment-item {
        width: 100%;
        background: rgba(255, 255, 255, 0.05);
        border: 2px solid var(--color-border);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--space-16) var(--space-20);
        cursor: pointer;
        transition: all var(--duration-normal);
        position: relative;
        backdrop-filter: blur(2px);
      }

      .segment-item:first-child {
        border-radius: 125px 125px 0 0;
        height: 100px;
        padding-top: var(--space-32);
      }

      .segment-item:last-child {
        border-radius: 0 0 125px 125px;
        height: 100px;
        padding-bottom: var(--space-32);
      }

      .segment-item:not(:first-child):not(:last-child) {
        height: 80px;
      }

      .segment-item:hover {
        transform: scale(1.02);
        box-shadow: var(--shadow-md);
        z-index: 10;
        background: rgba(255, 255, 255, 0.08);
      }

      #drum-graphic {
        transition: opacity 0.3s ease-in-out;
      }

      .segment-item.severity-critical {
        background: rgba(var(--color-error-rgb), 0.12);
        border-color: var(--color-error);
        border-width: 3px;
      }

      .segment-item.severity-moderate {
        background: rgba(var(--color-warning-rgb), 0.12);
        border-color: var(--color-warning);
      }

      .segment-item.severity-minor {
        background: rgba(var(--color-success-rgb), 0.08);
        border-color: var(--color-success);
      }

      .segment-item.severity-none {
        background: rgba(255, 255, 255, 0.05);
        border-color: var(--color-border);
      }

      .segment-label {
        font-size: var(--font-size-sm);
        font-weight: var(--font-weight-semibold);
        display: flex;
        flex-direction: column;
        gap: var(--space-2);
      }

      .segment-location {
        font-size: var(--font-size-xs);
        color: var(--color-text-secondary);
        font-weight: var(--font-weight-normal);
      }

      .segment-badge {
        font-size: var(--font-size-xs);
        padding: 4px 10px;
        border-radius: var(--radius-sm);
        font-weight: var(--font-weight-bold);
      }

      .badge-critical {
        background: var(--color-error);
        color: white;
      }

      .badge-moderate {
        background: var(--color-warning);
        color: white;
      }

      .badge-minor {
        background: var(--color-success);
        color: white;
      }

      .sidebar {
        width: 360px;
        display: flex;
        flex-direction: column;
        gap: var(--space-16);
      }

      .sidebar-section {
        background: var(--color-surface);
        border: 1px solid var(--color-card-border);
        border-radius: var(--radius-lg);
        padding: var(--space-20);
        box-shadow: var(--shadow-sm);
      }

      .sidebar-title {
        font-size: var(--font-size-lg);
        font-weight: var(--font-weight-bold);
        margin-bottom: var(--space-16);
        display: flex;
        align-items: center;
        gap: var(--space-8);
      }

      .critical-issue-item {
        padding: var(--space-12);
        border: 1px solid var(--color-card-border-inner);
        border-radius: var(--radius-base);
        margin-bottom: var(--space-12);
        transition: all var(--duration-fast);
        background: var(--color-bg-4);
      }

      .critical-issue-item:hover {
        border-color: var(--color-error);
        box-shadow: var(--shadow-sm);
      }

      .supervisor-checkbox {
        display: flex;
        align-items: center;
        gap: var(--space-8);
        margin-top: var(--space-12);
        padding: var(--space-8);
        background: rgba(var(--color-teal-500-rgb), 0.05);
        border-radius: var(--radius-base);
        font-size: var(--font-size-xs);
        cursor: pointer;
      }

      .supervisor-checkbox input[type="checkbox"] {
        cursor: pointer;
        width: 16px;
        height: 16px;
      }

      .dispatch-status {
        display: inline-flex;
        align-items: center;
        gap: var(--space-6);
        padding: var(--space-6) var(--space-10);
        border-radius: var(--radius-full);
        font-size: var(--font-size-xs);
        font-weight: var(--font-weight-medium);
        margin-top: var(--space-8);
      }

      .dispatch-status.pending {
        background: var(--color-secondary);
        color: var(--color-text-secondary);
      }

      .dispatch-status.ready {
        background: rgba(var(--color-warning-rgb), 0.15);
        color: var(--color-warning);
      }

      .dispatch-status.dispatched {
        background: rgba(var(--color-success-rgb), 0.15);
        color: var(--color-success);
      }

      .auto-dispatch-btn {
        width: 100%;
        margin-top: var(--space-8);
        background: linear-gradient(135deg, var(--color-primary), var(--color-primary-hover));
        color: var(--color-btn-primary-text);
        font-weight: var(--font-weight-semibold);
        padding: var(--space-10) var(--space-16);
        border: none;
        border-radius: var(--radius-base);
        cursor: pointer;
        transition: all var(--duration-normal);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-8);
      }

      .auto-dispatch-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      .auto-dispatch-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .issue-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: var(--space-8);
      }

      .issue-id {
        font-size: var(--font-size-xs);
        font-weight: var(--font-weight-bold);
        color: var(--color-error);
      }

      .issue-tray {
        font-size: var(--font-size-xs);
        background: var(--color-secondary);
        padding: 2px 8px;
        border-radius: var(--radius-sm);
      }

      .issue-type {
        font-size: var(--font-size-sm);
        font-weight: var(--font-weight-medium);
        margin-bottom: var(--space-4);
      }

      .issue-description {
        font-size: var(--font-size-xs);
        color: var(--color-text-secondary);
        margin-bottom: var(--space-8);
      }

      .issue-thumbnail {
        width: 100%;
        height: 100px;
        object-fit: cover;
        border-radius: var(--radius-sm);
        margin-top: var(--space-8);
      }

      .progress-tracker {
        display: flex;
        flex-direction: column;
        gap: var(--space-16);
      }

      .progress-bar-container {
        margin-bottom: var(--space-16);
      }

      .progress-label {
        display: flex;
        justify-content: space-between;
        margin-bottom: var(--space-8);
        font-size: var(--font-size-sm);
      }

      .progress-bar {
        width: 100%;
        height: 8px;
        background: var(--color-secondary);
        border-radius: var(--radius-full);
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: var(--color-primary);
        transition: width var(--duration-normal);
      }

      .phase-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--space-12);
        border-radius: var(--radius-base);
        background: var(--color-bg-1);
        margin-bottom: var(--space-8);
      }

      .phase-name {
        font-size: var(--font-size-sm);
        font-weight: var(--font-weight-medium);
      }

      .phase-status {
        font-size: var(--font-size-xs);
        padding: 4px 8px;
        border-radius: var(--radius-sm);
        font-weight: var(--font-weight-medium);
      }

      .status-completed {
        background: rgba(var(--color-success-rgb), 0.15);
        color: var(--color-success);
      }

      .status-in-progress {
        background: rgba(var(--color-warning-rgb), 0.15);
        color: var(--color-warning);
      }

      .status-not-started {
        background: var(--color-secondary);
        color: var(--color-text-secondary);
      }

      /* Detail View Styles */
      .detail-view {
        display: none;
      }

      .detail-view.active {
        display: flex;
        flex-direction: column;
        gap: var(--space-24);
      }

      .detail-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .detail-header h2 {
        font-size: var(--font-size-3xl);
        margin: 0;
      }

      .detail-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--space-24);
      }

      .defect-map {
        background: var(--color-surface);
        border: 1px solid var(--color-card-border);
        border-radius: var(--radius-lg);
        padding: var(--space-24);
        box-shadow: var(--shadow-sm);
        position: relative;
        min-height: 400px;
      }

      .defect-map-title {
        font-size: var(--font-size-lg);
        font-weight: var(--font-weight-bold);
        margin-bottom: var(--space-16);
      }

      .tray-diagram {
        width: 100%;
        height: 300px;
        background: var(--color-bg-1);
        border: 2px solid var(--color-border);
        border-radius: 50%;
        position: relative;
        margin: var(--space-24) auto;
      }

      .defect-pin {
        position: absolute;
        width: 24px;
        height: 24px;
        background: var(--color-error);
        border: 2px solid white;
        border-radius: 50%;
        cursor: pointer;
        transition: transform var(--duration-fast);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: var(--font-size-xs);
        font-weight: var(--font-weight-bold);
      }

      .defect-pin:hover {
        transform: scale(1.3);
        z-index: 10;
      }

      .defect-pin.moderate {
        background: var(--color-warning);
      }

      .filters-panel {
        background: var(--color-surface);
        border: 1px solid var(--color-card-border);
        border-radius: var(--radius-lg);
        padding: var(--space-20);
        box-shadow: var(--shadow-sm);
      }

      .filter-group {
        margin-bottom: var(--space-16);
      }

      .filter-label {
        font-size: var(--font-size-sm);
        font-weight: var(--font-weight-medium);
        margin-bottom: var(--space-8);
        display: block;
      }

      .filter-select {
        width: 100%;
        padding: var(--space-8) var(--space-12);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-base);
        background: var(--color-surface);
        color: var(--color-text);
        font-size: var(--font-size-sm);
      }

      .image-gallery {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: var(--space-12);
        margin-top: var(--space-16);
      }

      .gallery-image {
        width: 100%;
        height: 120px;
        object-fit: cover;
        border-radius: var(--radius-base);
        cursor: pointer;
        border: 2px solid var(--color-card-border);
        transition: all var(--duration-fast);
      }

      .gallery-image:hover {
        border-color: var(--color-primary);
        transform: scale(1.05);
      }

      /* Defect Analysis Panel */
      .defect-analysis-panel {
        position: fixed;
        top: 0;
        right: -600px;
        width: 600px;
        height: 100vh;
        background: var(--color-surface);
        border-left: 1px solid var(--color-border);
        box-shadow: var(--shadow-lg);
        overflow-y: auto;
        transition: right var(--duration-normal) var(--ease-standard);
        z-index: 1000;
      }

      .defect-analysis-panel.active {
        right: 0;
      }

      .analysis-header {
        padding: var(--space-24);
        border-bottom: 1px solid var(--color-border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        background: var(--color-surface);
        z-index: 10;
      }

      .close-btn {
        width: 32px;
        height: 32px;
        border-radius: var(--radius-base);
        border: none;
        background: var(--color-secondary);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: var(--font-size-lg);
        color: var(--color-text);
      }

      .close-btn:hover {
        background: var(--color-secondary-hover);
      }

      .analysis-content {
        padding: var(--space-24);
      }

      .analysis-section {
        margin-bottom: var(--space-24);
      }

      .analysis-section h3 {
        font-size: var(--font-size-lg);
        margin-bottom: var(--space-12);
      }

      .defect-image-large {
        width: 100%;
        border-radius: var(--radius-lg);
        margin-bottom: var(--space-16);
      }

      .metadata-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-16);
      }

      .metadata-item {
        display: flex;
        flex-direction: column;
        gap: var(--space-4);
      }

      .metadata-label {
        font-size: var(--font-size-xs);
        color: var(--color-text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .metadata-value {
        font-size: var(--font-size-base);
        font-weight: var(--font-weight-medium);
      }

      .action-items {
        background: var(--color-bg-2);
        padding: var(--space-16);
        border-radius: var(--radius-lg);
        border: 1px solid var(--color-border);
      }

      .action-item {
        display: flex;
        align-items: start;
        gap: var(--space-12);
        margin-bottom: var(--space-12);
        font-size: var(--font-size-sm);
      }

      .action-item:last-child {
        margin-bottom: 0;
      }

      .overview-view.hidden {
        display: none;
      }

      .severity-legend {
        display: flex;
        gap: var(--space-16);
        margin-top: var(--space-16);
        font-size: var(--font-size-xs);
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: var(--space-6);
      }

      .legend-color {
        width: 16px;
        height: 16px;
        border-radius: var(--radius-sm);
      }

      .heatmap-toggle {
        margin-top: var(--space-12);
      }

      /* Workflow Modal */
      .workflow-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 2000;
        backdrop-filter: blur(4px);
      }

      .workflow-modal.active {
        display: flex;
      }

      .workflow-content {
        background: var(--color-surface);
        border-radius: var(--radius-lg);
        padding: var(--space-32);
        max-width: 700px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: var(--shadow-lg);
        position: relative;
      }

      .workflow-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-24);
      }

      .workflow-step {
        display: flex;
        align-items: start;
        gap: var(--space-16);
        padding: var(--space-16);
        background: var(--color-bg-1);
        border-radius: var(--radius-base);
        margin-bottom: var(--space-12);
        border: 1px solid var(--color-border);
        transition: all var(--duration-normal);
      }

      .workflow-step.active {
        background: rgba(var(--color-primary-rgb), 0.1);
        border-color: var(--color-primary);
      }

      .workflow-step.completed {
        background: rgba(var(--color-success-rgb), 0.1);
        border-color: var(--color-success);
      }

      .step-icon {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: var(--font-size-lg);
        flex-shrink: 0;
      }

      .step-icon.pending {
        background: var(--color-secondary);
        color: var(--color-text-secondary);
      }

      .step-icon.active {
        background: var(--color-primary);
        color: var(--color-btn-primary-text);
      }

      .step-icon.completed {
        background: var(--color-success);
        color: white;
      }

      .step-content {
        flex: 1;
      }

      .step-title {
        font-weight: var(--font-weight-semibold);
        margin-bottom: var(--space-4);
      }

      .step-description {
        font-size: var(--font-size-sm);
        color: var(--color-text-secondary);
      }

      .workflow-success {
        background: rgba(var(--color-success-rgb), 0.1);
        border: 2px solid var(--color-success);
        padding: var(--space-20);
        border-radius: var(--radius-lg);
        margin-top: var(--space-24);
        text-align: center;
      }

      .workflow-success h3 {
        color: var(--color-success);
        margin-bottom: var(--space-12);
      }

      @media (max-width: 1200px) {
        .dashboard-main {
          flex-direction: column;
        }

        .sidebar {
          width: 100%;
        }

        .detail-content {
          grid-template-columns: 1fr;
        }

        .defect-analysis-panel {
          width: 100%;
          right: -100%;
        }

        .workflow-content {
          width: 95%;
          padding: var(--space-24);
        }
      }
    </style>
  </head>
  <body>
    <div class="dashboard-container">
      <!-- Header -->
      <header class="dashboard-header">
        <div class="header-content">
          <div class="header-title">
            <h1>Refinery Drum Inspection Dashboard</h1>
            <div class="breadcrumb" id="breadcrumb">
              <span class="breadcrumb-item active" onclick="navigateToOverview()">Overview</span>
            </div>
          </div>
          <div class="header-actions">
            <button class="btn btn-secondary" onclick="showProgressTracker()">Progress Tracker</button>
            <button class="btn btn-primary" onclick="exportReport()">Export PDF Report</button>
          </div>
        </div>
      </header>

      <!-- Main Dashboard -->
      <div class="dashboard-main">
        <!-- Main Content Area -->
        <main class="main-content">
          <!-- Overview View -->
          <div id="overview-view" class="overview-view">
            <!-- Metrics Panel -->
            <div class="metrics-panel">
              <div class="metric-card">
                <div class="metric-label">Total Segments</div>
                <div class="metric-value">6</div>
                <div class="metric-subtext">100% Inspected</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Total Defects</div>
                <div class="metric-value">11</div>
                <div class="metric-subtext">Across all segments</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Critical Issues</div>
                <div class="metric-value" style="color: var(--color-error);">3</div>
                <div class="metric-subtext">All in Segment 2</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Inspection Date</div>
                <div class="metric-value" style="font-size: var(--font-size-lg);">Nov 9, 2025</div>
                <div class="metric-subtext">Drum: DRUM-VES-01</div>
              </div>
            </div>

            <!-- Drum Visualization -->
            <div class="column-visualization">
              <div class="drum-container">
                <div style="text-align: center; margin-bottom: var(--space-24);">
                  <h2 style="font-size: var(--font-size-2xl); margin-bottom: var(--space-8);">Refinery Drum DRUM-VES-01</h2>
                  <p style="color: var(--color-text-secondary); font-size: var(--font-size-sm);">Hover over segments to highlight | Click to view detailed inspection data</p>
                </div>
                <!-- Add display flex container -->
                <div style="display: flex; gap: var(--space-24); align-items: flex-start; justify-content: center;">
                  <!-- Drum Graphic -->
                  <div style="flex: 1; width: 350px; height: 500px;">
                    <img id="drum-graphic" src="./DrumSelection0.png" alt="Drum Vessel" style="width: 100%; height: 100%; object-fit: contain; border-radius: var(--radius-lg);">
                  </div>
                  <!-- Drum Vessel Segments -->
                  <div style="flex: 1; width: 350px; height: 500px;">
                    <div class="drum-vessel" id="drum-vessel" style="height: 100%;">
                      <!-- Segments will be dynamically generated -->
                    </div>
                  </div>
                </div>
                <!-- Legend stays below -->
                <div class="severity-legend" style="margin-top: var(--space-24);">
                  <div class="legend-item">
                    <div class="legend-color" style="background: rgba(var(--color-error-rgb), 0.12); border: 2px solid var(--color-error);"></div>
                    <span>Critical</span>
                  </div>
                  <div class="legend-item">
                    <div class="legend-color" style="background: rgba(var(--color-warning-rgb), 0.12); border: 2px solid var(--color-warning);"></div>
                    <span>Moderate</span>
                  </div>
                  <div class="legend-item">
                    <div class="legend-color" style="background: rgba(var(--color-success-rgb), 0.08); border: 2px solid var(--color-success);"></div>
                    <span>Minor</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Detail View -->
          <div id="detail-view" class="detail-view">
            <div class="detail-header">
              <h2 id="detail-title">Segment 4 - Detailed Inspection</h2>
              <button class="btn btn-secondary" onclick="navigateToOverview()">Back to Overview</button>
            </div>

            <div class="detail-content">
              <!-- Defect Map -->
              <div class="defect-map">
                <div class="defect-map-title">Defect Location Map</div>
                <div class="tray-diagram" id="tray-diagram">
                  <!-- Defect pins will be dynamically placed -->
                </div>
                <div class="heatmap-toggle">
                  <label style="font-size: var(--font-size-sm); display: flex; align-items: center; gap: var(--space-8); cursor: pointer;">
                    <input type="checkbox" id="heatmap-toggle" onchange="toggleHeatmap()">
                    Show heat map overlay
                  </label>
                </div>
                <div style="margin-top: var(--space-24);">
                  <h4 style="font-size: var(--font-size-base); margin-bottom: var(--space-12);">Inspection Images</h4>
                  <div class="image-gallery" id="image-gallery">
                    <!-- Images will be dynamically loaded -->
                  </div>
                </div>
              </div>

              <!-- Filters Panel -->
              <div class="filters-panel">
                <h3 style="font-size: var(--font-size-lg); margin-bottom: var(--space-16);">Defect Filters</h3>
                
                <div class="filter-group">
                  <label class="filter-label">Defect Type</label>
                  <select class="filter-select" id="filter-type" onchange="applyFilters()">
                    <option value="all">All Types</option>
                    <option value="structural">Structural Damage</option>
                    <option value="corrosion">Corrosion</option>
                    <option value="rust">Rust</option>
                    <option value="fouling">Fouling</option>
                  </select>
                </div>

                <div class="filter-group">
                  <label class="filter-label">Severity</label>
                  <select class="filter-select" id="filter-severity" onchange="applyFilters()">
                    <option value="all">All Severities</option>
                    <option value="critical">Critical</option>
                    <option value="moderate">Moderate</option>
                    <option value="minor">Minor</option>
                  </select>
                </div>

                <div class="filter-group">
                  <label class="filter-label">Repair Status</label>
                  <select class="filter-select" id="filter-status" onchange="applyFilters()">
                    <option value="all">All Statuses</option>
                    <option value="pending">Pending</option>
                    <option value="scheduled">Scheduled</option>
                    <option value="completed">Completed</option>
                  </select>
                </div>

                <div style="margin-top: var(--space-24); padding-top: var(--space-24); border-top: 1px solid var(--color-border);">
                  <h4 style="font-size: var(--font-size-base); margin-bottom: var(--space-12);">Detected Defects</h4>
                  <div id="defect-list">
                    <!-- Defect list will be populated dynamically -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>

        <!-- Sidebar -->
        <aside class="sidebar">
          <!-- Critical Issues -->
          <div class="sidebar-section">
            <div class="sidebar-title">
              <span>ðŸ”´</span>
              Critical Issues
            </div>
            <div id="critical-issues-list">
              <!-- Critical issues will be dynamically populated -->
            </div>
          </div>

          <!-- Progress Tracker -->
          <div class="sidebar-section">
            <div class="sidebar-title">
              <span>ðŸ“Š</span>
              Project Progress
            </div>
            <div class="progress-tracker">
              <div class="progress-bar-container">
                <div class="progress-label">
                  <span>Overall Completion</span>
                  <span>67%</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 100%;"></div>
                </div>
              </div>
              <div id="phases-list">
                <!-- Phases will be populated dynamically -->
              </div>
            </div>
          </div>
        </aside>
      </div>
    </div>

    <!-- Defect Analysis Panel -->
    <div id="defect-analysis-panel" class="defect-analysis-panel">
      <div class="analysis-header">
        <h2 id="analysis-defect-title" style="font-size: var(--font-size-2xl); margin: 0;">Defect Analysis</h2>
        <button class="close-btn" onclick="closeDefectAnalysis()">âœ•</button>
      </div>
      <div class="analysis-content" id="analysis-content">
        <!-- Content will be dynamically populated -->
      </div>
    </div>

    <!-- Workflow Automation Modal -->
    <div id="workflow-modal" class="workflow-modal">
      <div class="workflow-content">
        <div class="workflow-header">
          <h2 style="margin: 0;">ðŸ¤– Auto-Dispatch Workflow</h2>
          <button class="close-btn" onclick="closeWorkflowModal()">âœ•</button>
        </div>
        <div id="workflow-steps">
          <!-- Steps will be dynamically populated -->
        </div>
        <div id="workflow-success" style="display: none;">
          <!-- Success message will be shown here -->
        </div>
      </div>
    </div>

    <script>
      // Application Data
      const inspectionData = {
        vessel_id: 'DRUM-VES-01',
        vessel_type: 'Refinery Drum',
        inspection_date: '2025-11-08',
        total_segments: 6,
        inspected_segments: 6,
        completion_percentage: 100,
        total_defects: 18,
        critical_defects: 6,
        moderate_defects: 7,
        minor_defects: 5
      };

      const criticalIssues = [
        {
          defect_id: 'DEF-201',
          segment_number: 2,
          severity: 'critical',
          damage_type: 'Severe Corrosion',
          confidence_score: 0.94,
          timestamp: '2025-11-08T09:23:15Z',
          image_thumbnail: './corrosion.jpg',
          description: 'Advanced corrosion with material loss on weld seam',
          supervisor_reviewed: false,
          auto_dispatch_ready: true,
          dispatch_status: 'Pending Review'
        },
        {
          defect_id: 'DEF-202',
          segment_number: 2,
          severity: 'critical',
          damage_type: 'Crack Propagation',
          confidence_score: 0.91,
          timestamp: '2025-11-08T08:45:22Z',
          image_thumbnail: './crack.png',
          description: 'Stress crack detected near circumferential weld',
          supervisor_reviewed: false,
          auto_dispatch_ready: true,
          dispatch_status: 'Pending Review'
        },
        {
          defect_id: 'DEF-203',
          segment_number: 2,
          severity: 'critical',
          damage_type: 'Shell Thinning',
          confidence_score: 0.89,
          timestamp: '2025-11-08T10:12:08Z',
          image_thumbnail: './thin.png',
          description: 'Significant wall thickness reduction detected - below minimum spec',
          supervisor_reviewed: false,
          auto_dispatch_ready: true,
          dispatch_status: 'Pending Review'
        }
      ];

      const segmentStatus = [
        { segment: 1, status: 'completed', defects: 2, severity_max: 'minor', location: 'Top Head' },
        { segment: 2, status: 'completed', defects: 3, severity_max: 'critical', location: 'Upper Shell' },
        { segment: 3, status: 'completed', defects: 2, severity_max: 'moderate', location: 'Mid-Upper Shell' },
        { segment: 4, status: 'completed', defects: 2, severity_max: 'moderate', location: 'Mid-Lower Shell' },
        { segment: 5, status: 'completed', defects: 1, severity_max: 'minor', location: 'Lower Shell' },
        { segment: 6, status: 'completed', defects: 1, severity_max: 'moderate', location: 'Bottom Head' }
      ];

      const maintenanceTeams = [
        {
          team_id: 'TEAM-001',
          team_name: 'Structural Welding Team A',
          specialties: ['Weld Failure', 'Structural Damage', 'Crack Repair'],
          contact: 'welding-team-a@refinery.com',
          availability: 'Available'
        },
        {
          team_id: 'TEAM-002',
          team_name: 'Corrosion Repair Team B',
          specialties: ['Severe Corrosion', 'Rust Penetration', 'Material Loss'],
          contact: 'corrosion-team-b@refinery.com',
          availability: 'Available'
        },
        {
          team_id: 'TEAM-003',
          team_name: 'Emergency Response Team',
          specialties: ['Critical Structural', 'Shell Deformation', 'Pressure Integrity'],
          contact: 'emergency-team@refinery.com',
          availability: 'On-Call 24/7'
        }
      ];

      const progressPhases = [
        { name: 'Pre-Inspection Planning', status: 'completed', completion: 100 },
        { name: 'Drone Data Collection', status: 'completed', completion: 100 },
        { name: 'AI Data Analysis', status: 'completed', completion: 100 },
        { name: 'Repair Scheduling', status: 'in_progress', completion: 35 },
        { name: 'Post-Repair Verification', status: 'not_started', completion: 0 }
      ];

      const segmentDetailData = {
        2: {
          defects: [
            {
              defect_id: 'DEF-201',
              type: 'Severe Corrosion',
              severity: 'critical',
              confidence: 0.94,
              location: { x: 70, y: 50 },
              dimensions: { length_mm: 280, width_mm: 150 },
              repair_status: 'Pending Review',
              assigned_team: 'Corrosion Repair Team B',
              description: 'Advanced corrosion with material loss on weld seam',
              recommendations: 'Immediate repair required. Material replacement may be necessary.'
            },
            {
              defect_id: 'DEF-202',
              type: 'Crack Propagation',
              severity: 'critical',
              confidence: 0.91,
              location: { x: 250, y: -15},
              dimensions: { length_mm: 180, width_mm: 60 },
              repair_status: 'Pending Review',
              assigned_team: 'Structural Welding Team A',
              description: 'Stress crack detected near circumferential weld',
              recommendations: 'Stop-drill crack ends. Weld repair and stress relief treatment required.'
            },
            {
              defect_id: 'DEF-203',
              type: 'Shell Thinning',
              severity: 'critical',
              confidence: 0.89,
              location: { x: 450, y: 360 },
              dimensions: { length_mm: 200, width_mm: 100 },
              repair_status: 'Pending Review',
              assigned_team: 'Corrosion Repair Team B',
              description: 'Significant wall thickness reduction detected - below minimum spec',
              recommendations: 'Ultrasonic testing required. Plate replacement recommended.'
            }
          ]
        },
        1: {
          defects: [
            {
              defect_id: 'DEF-101',
              type: 'Minor Surface Rust',
              severity: 'minor',
              confidence: 0.78,
              location: { x: 170, y: 190 },
              dimensions: { length_mm: 100, width_mm: 60 },
              repair_status: 'Scheduled',
              assigned_team: 'Maintenance Team',
              description: 'Surface rust on top head section',
              recommendations: 'Surface preparation and coating application.'
            }
          ]
        },
        3: {
          defects: [
            {
              defect_id: 'DEF-301',
              type: 'Moderate Corrosion',
              severity: 'moderate',
              confidence: 0.82,
              location: { x: 200, y: 200 },
              dimensions: { length_mm: 140, width_mm: 80 },
              repair_status: 'Scheduled',
              assigned_team: 'Corrosion Repair Team B',
              description: 'Surface corrosion on mid-upper shell',
              recommendations: 'Clean and apply protective coating. Monitor for progression.'
            }
          ]
        },
        4: {
          defects: [
            {
              defect_id: 'DEF-401',
              type: 'Moderate Rust',
              severity: 'moderate',
              confidence: 0.80,
              location: { x: 190, y: 210 },
              dimensions: { length_mm: 130, width_mm: 70 },
              repair_status: 'Scheduled',
              assigned_team: 'Maintenance Team',
              description: 'Moderate rust formation on mid-lower shell',
              recommendations: 'Rust removal and coating application.'
            }
          ]
        },
        5: {
          defects: [
            {
              defect_id: 'DEF-501',
              type: 'Minor Coating Damage',
              severity: 'minor',
              confidence: 0.75,
              location: { x: 180, y: 200 },
              dimensions: { length_mm: 90, width_mm: 50 },
              repair_status: 'Scheduled',
              assigned_team: 'Maintenance Team',
              description: 'Minor coating damage on lower shell',
              recommendations: 'Touch-up coating repair.'
            }
          ]
        },
        6: {
          defects: [
            {
              defect_id: 'DEF-601',
              type: 'Moderate Surface Wear',
              severity: 'moderate',
              confidence: 0.79,
              location: { x: 185, y: 205 },
              dimensions: { length_mm: 110, width_mm: 65 },
              repair_status: 'Scheduled',
              assigned_team: 'Maintenance Team',
              description: 'Surface wear on bottom head',
              recommendations: 'Surface preparation and protective coating.'
            }
          ]
        }
      };

      // State
      let currentView = 'overview';
      let currentSegment = null;
      let selectedDefect = null;
      let defectCheckboxStates = {};

      // Initialize Dashboard
      function initializeDashboard() {
        renderDrumVessel();
        renderCriticalIssues();
        renderProgressPhases();
      }

      // Drum Graphic Hover State Management
      const drumGraphicImages = {
        0: './DrumSelection0.png',
        1: './DrumSelection1.png',
        2: './DrumSelection2.png',
        3: './DrumSelection3.png',
        4: './DrumSelection4.png',
        5: './DrumSelection5.png',
        6: './DrumSelection6.png'
      };

      function updateDrumGraphic(segmentNumber) {
        const drumGraphic = document.getElementById('drum-graphic');
        if (drumGraphic) {
          drumGraphic.src = drumGraphicImages[segmentNumber];
        }
      }

      function resetDrumGraphic() {
        updateDrumGraphic(0);
      }

      // Render Drum Vessel
      function renderDrumVessel() {
        const vessel = document.getElementById('drum-vessel');
        vessel.innerHTML = '';
        
        segmentStatus.forEach(segment => {
          const segmentElement = document.createElement('div');
          segmentElement.className = `segment-item severity-${segment.severity_max}`;
          segmentElement.onclick = () => navigateToSegment(segment.segment);
          
          // Add hover event listeners for drum graphic
          segmentElement.onmouseenter = () => updateDrumGraphic(segment.segment);
          segmentElement.onmouseleave = () => resetDrumGraphic();
          
          const label = document.createElement('div');
          label.className = 'segment-label';
          label.innerHTML = `
            <span>Segment ${segment.segment}</span>
            <span class="segment-location">${segment.location}</span>
          `;
          
          const badge = document.createElement('span');
          if (segment.defects > 0) {
            badge.className = `segment-badge badge-${segment.severity_max}`;
            badge.textContent = segment.defects;
          }
          
          segmentElement.appendChild(label);
          segmentElement.appendChild(badge);
          vessel.appendChild(segmentElement);
        });
      }

      // Render Critical Issues
      function renderCriticalIssues() {
        const list = document.getElementById('critical-issues-list');
        list.innerHTML = '';
        
        criticalIssues.forEach(issue => {
          const item = document.createElement('div');
          item.className = 'critical-issue-item';
          
          const dispatchStatusClass = issue.dispatch_status === 'Dispatched' ? 'dispatched' : 
                                      defectCheckboxStates[issue.defect_id] ? 'ready' : 'pending';
          const dispatchStatusText = issue.dispatch_status === 'Dispatched' ? 'Dispatched' : 
                                    defectCheckboxStates[issue.defect_id] ? 'Ready for Dispatch' : 'Pending Review';
          
          item.innerHTML = `
            <div class="issue-header">
              <span class="issue-id">${issue.defect_id}</span>
              <span class="issue-tray">Segment ${issue.segment_number}</span>
            </div>
            <div class="issue-type">${issue.damage_type}</div>
            <div class="issue-description">${issue.description}</div>
            <div style="font-size: var(--font-size-xs); color: var(--color-text-secondary);">Confidence: ${(issue.confidence_score * 100).toFixed(0)}%</div>
            <img src="${issue.image_thumbnail}" alt="${issue.damage_type}" class="issue-thumbnail" style="cursor: pointer;" onclick="event.stopPropagation(); navigateToDefect(${issue.segment_number}, '${issue.defect_id}')">
            <div class="dispatch-status ${dispatchStatusClass}">
              ${issue.dispatch_status === 'Dispatched' ? 'âœ“' : dispatchStatusClass === 'ready' ? 'âš¡' : 'â±ï¸'} ${dispatchStatusText}
            </div>
            ${issue.dispatch_status !== 'Dispatched' ? `
              <label class="supervisor-checkbox" onclick="event.stopPropagation();">
                <input type="checkbox" id="check-${issue.defect_id}" onchange="toggleDefectCheckbox('${issue.defect_id}')" ${defectCheckboxStates[issue.defect_id] ? 'checked' : ''}>
                <span>Mark as significant for action</span>
              </label>
              ${defectCheckboxStates[issue.defect_id] ? `
                <button class="auto-dispatch-btn" onclick="event.stopPropagation(); startAutoDispatch('${issue.defect_id}')">
                  <span>ðŸ¤–</span>
                  <span>Auto-Dispatch Workflow</span>
                </button>
              ` : ''}
            ` : `
              <div style="margin-top: var(--space-8); padding: var(--space-8); background: rgba(var(--color-success-rgb), 0.1); border-radius: var(--radius-base); font-size: var(--font-size-xs);">
                <strong>Assigned Team:</strong> ${issue.assigned_team}
              </div>
            `}
          `;
          
          list.appendChild(item);
        });
      }

      // Render Progress Phases
      function renderProgressPhases() {
        const list = document.getElementById('phases-list');
        list.innerHTML = '';
        
        progressPhases.forEach(phase => {
          const item = document.createElement('div');
          item.className = 'phase-item';
          
          const statusClass = phase.status === 'completed' ? 'status-completed' : 
                            phase.status === 'in_progress' ? 'status-in-progress' : 
                            'status-not-started';
          
          const statusText = phase.status === 'completed' ? 'Completed' : 
                            phase.status === 'in_progress' ? `${phase.completion}%` : 
                            'Not Started';
          
          item.innerHTML = `
            <span class="phase-name">${phase.name}</span>
            <span class="phase-status ${statusClass}">${statusText}</span>
          `;
          
          list.appendChild(item);
        });
      }

      // Toggle checkbox state for a defect (supervisor review)
      function toggleDefectCheckbox(defectId) {
        // flip stored state
        defectCheckboxStates[defectId] = !defectCheckboxStates[defectId];

        // re-render the critical issues list so the UI (button visibility) updates
        renderCriticalIssues();

        // Find the issue data
        const issue = criticalIssues.find(i => i.defect_id === defectId);
        // If the issue exists and is configured to allow auto dispatch, start workflow automatically when checked
        if (defectCheckboxStates[defectId] && issue && issue.auto_dispatch_ready) {
          // Start the auto-dispatch workflow
          startAutoDispatch(defectId);
        }
      }

      // Start an Auto-Dispatch workflow for a defect
      function startAutoDispatch(defectId) {
        const modal = document.getElementById('workflow-modal');
        const stepsContainer = document.getElementById('workflow-steps');
        const successContainer = document.getElementById('workflow-success');

        // find the issue
        const issue = criticalIssues.find(i => i.defect_id === defectId);
        if (!issue) return;

        // Prepare steps
        const steps = [
          { id: 1, title: 'Validate Defect', status: 'pending' },
          { id: 2, title: 'Select Repair Team', status: 'pending' },
          { id: 3, title: 'Schedule Repair', status: 'pending' },
          { id: 4, title: 'Notify Team & Create Work Order', status: 'pending' }
        ];

        // Render initial steps
        stepsContainer.innerHTML = '';
        successContainer.style.display = 'none';
        steps.forEach(step => {
          const el = document.createElement('div');
          el.className = 'workflow-step';
          el.id = `workflow-step-${step.id}`;
          el.innerHTML = `
            <div class="step-icon pending">${step.id}</div>
            <div class="step-content">
              <div class="step-title">${step.title}</div>
              <div class="step-description" id="workflow-desc-${step.id}">Waiting...</div>
            </div>
          `;
          stepsContainer.appendChild(el);
        });

        // Show modal
        modal.classList.add('active');

        // Simulate step progression with delays
        let idx = 0;
        function runNextStep() {
          if (idx >= steps.length) {
            // complete: mark issue dispatched and update UI
            issue.dispatch_status = 'Dispatched';
            issue.assigned_team = issue.assigned_team || 'Auto-Dispatch Team';
            renderCriticalIssues();

            // show success
            successContainer.style.display = 'block';
            successContainer.innerHTML = `
              <div class="workflow-success">
                <h3>Auto-Dispatch Completed</h3>
                <p>Defect ${defectId} has been dispatched to <strong>${issue.assigned_team}</strong>.</p>
              </div>
            `;

            // Auto-close after a short delay
            setTimeout(() => {
              closeWorkflowModal();
            }, 1200);

            return;
          }

          const stepNum = idx + 1;
          const stepEl = document.getElementById(`workflow-step-${stepNum}`);
          if (stepEl) {
            // mark active
            stepEl.classList.add('active');
            const desc = document.getElementById(`workflow-desc-${stepNum}`);
            if (desc) desc.textContent = 'In progress...';

            // simulate async work
            setTimeout(() => {
              // mark completed
              stepEl.classList.remove('active');
              stepEl.classList.add('completed');
              const icon = stepEl.querySelector('.step-icon');
              if (icon) {
                icon.classList.remove('pending');
                icon.classList.add('completed');
                icon.textContent = 'âœ“';
              }
              const desc = document.getElementById(`workflow-desc-${stepNum}`);
              if (desc) desc.textContent = 'Completed';

              idx++;
              runNextStep();
            }, 800);
          } else {
            idx++;
            runNextStep();
          }
        }

        // Start the sequence
        runNextStep();
      }

      function closeWorkflowModal() {
        const modal = document.getElementById('workflow-modal');
        const stepsContainer = document.getElementById('workflow-steps');
        const successContainer = document.getElementById('workflow-success');
        modal.classList.remove('active');
        stepsContainer.innerHTML = '';
        successContainer.style.display = 'none';
        successContainer.innerHTML = '';
      }

      // Navigation Functions
      function navigateToOverview() {
        currentView = 'overview';
        currentSegment = null;
        document.getElementById('overview-view').classList.remove('hidden');
        document.getElementById('detail-view').classList.remove('active');
        updateBreadcrumb();
      }

      function navigateToSegment(segmentNumber) {
        currentView = 'detail';
        currentSegment = segmentNumber;
        document.getElementById('overview-view').classList.add('hidden');
        document.getElementById('detail-view').classList.add('active');
        const segment = segmentStatus.find(s => s.segment === segmentNumber);
        document.getElementById('detail-title').textContent = `Segment ${segmentNumber} - ${segment.location}`;
        
        updateBreadcrumb();
        renderSegmentDetail(segmentNumber);
      }

      function navigateToDefect(segmentNumber, defectId) {
        if (currentView !== 'detail' || currentSegment !== segmentNumber) {
          navigateToSegment(segmentNumber);
        }
        setTimeout(() => {
          showDefectAnalysis(defectId);
        }, 300);
      }

      function updateBreadcrumb() {
        const breadcrumb = document.getElementById('breadcrumb');
        
        if (currentView === 'overview') {
          breadcrumb.innerHTML = '<span class="breadcrumb-item active">Overview</span>';
        } else if (currentView === 'detail') {
          breadcrumb.innerHTML = `
            <span class="breadcrumb-item" onclick="navigateToOverview()">Overview</span>
            <span class="breadcrumb-separator">â€º</span>
            <span class="breadcrumb-item active">Segment ${currentSegment}</span>
          `;
        }
      }

      // Render Segment Detail
      function renderSegmentDetail(segmentNumber) {
        const segmentData = segmentDetailData[segmentNumber] || { defects: [] };
        
        // Render defect pins
        const diagram = document.getElementById('tray-diagram');
        diagram.innerHTML = '';
        
        segmentData.defects.forEach((defect, index) => {
          const pin = document.createElement('div');
          pin.className = `defect-pin ${defect.severity}`;
          pin.style.left = `${(defect.location.x / 500) * 100}%`;
          pin.style.top = `${(defect.location.y / 500) * 100}%`;
          pin.textContent = index + 1;
          pin.onclick = () => showDefectAnalysis(defect.defect_id);
          diagram.appendChild(pin);
        });
        
        // Render image gallery
        const gallery = document.getElementById('image-gallery');
        gallery.innerHTML = '';
        const images = [
          './stock1.png',
          './stock2.png',
          './stock3.png',
        ];
        
        images.forEach(img => {
          const imgEl = document.createElement('img');
          imgEl.src = img;
          imgEl.className = 'gallery-image';
          imgEl.alt = 'Inspection image';
          imgEl.onclick = () => {
            window.open(img, '_blank');
          };
          gallery.appendChild(imgEl);
        });
        
        // Render defect list
        renderDefectList(segmentData.defects);
      }

      function renderDefectList(defects) {
        const list = document.getElementById('defect-list');
        list.innerHTML = '';
        
        if (defects.length === 0) {
          list.innerHTML = '<p style="color: var(--color-text-secondary); font-size: var(--font-size-sm);">No defects detected on this tray.</p>';
          return;
        }
        
        defects.forEach((defect, index) => {
          const item = document.createElement('div');
          item.className = 'critical-issue-item';
          item.style.background = defect.severity === 'critical' ? 'var(--color-bg-4)' : 'var(--color-bg-2)';
          item.onclick = () => showDefectAnalysis(defect.defect_id);
          
          item.innerHTML = `
            <div class="issue-header">
              <span class="issue-id">${defect.defect_id}</span>
              <span class="issue-tray">Pin ${index + 1}</span>
            </div>
            <div class="issue-type">${defect.type}</div>
            <div class="issue-description">${defect.description}</div>
            <div style="font-size: var(--font-size-xs); color: var(--color-text-secondary); margin-top: var(--space-4);">Status: ${defect.repair_status}</div>
          `;
          
          list.appendChild(item);
        });
      }

      // Show Defect Analysis Panel
      function showDefectAnalysis(defectId) {
        const panel = document.getElementById('defect-analysis-panel');
        const content = document.getElementById('analysis-content');
        
        // Find defect data
        let defect = null;
        for (const segment in segmentDetailData) {
          const found = segmentDetailData[segment].defects.find(d => d.defect_id === defectId);
          if (found) {
            defect = found;
            break;
          }
        }
        
        if (!defect) return;
        
        document.getElementById('analysis-defect-title').textContent = `${defect.defect_id} Analysis`;
        
        content.innerHTML = `
          <div class="analysis-section">
            <img src="./corrosion.jpg" alt="Defect image" class="defect-image-large">
          </div>
          
          <div class="analysis-section">
            <h3>Defect Information</h3>
            <div class="metadata-grid">
              <div class="metadata-item">
                <span class="metadata-label">Defect ID</span>
                <span class="metadata-value">${defect.defect_id}</span>
              </div>
              <div class="metadata-item">
                <span class="metadata-label">Type</span>
                <span class="metadata-value">${defect.type}</span>
              </div>
              <div class="metadata-item">
                <span class="metadata-label">Severity</span>
                <span class="metadata-value" style="color: ${defect.severity === 'critical' ? 'var(--color-error)' : 'var(--color-warning)'}; text-transform: capitalize;">${defect.severity}</span>
              </div>
              <div class="metadata-item">
                <span class="metadata-label">Confidence Score</span>
                <span class="metadata-value">${(defect.confidence * 100).toFixed(0)}%</span>
              </div>
              <div class="metadata-item">
                <span class="metadata-label">Location</span>
                <span class="metadata-value">Segment ${currentSegment}</span>
              </div>
              <div class="metadata-item">
                <span class="metadata-label">Dimensions</span>
                <span class="metadata-value">${defect.dimensions.length_mm} Ã— ${defect.dimensions.width_mm} mm</span>
              </div>
              <div class="metadata-item">
                <span class="metadata-label">Repair Status</span>
                <span class="metadata-value">${defect.repair_status}</span>
              </div>
              <div class="metadata-item">
                <span class="metadata-label">Assigned Team</span>
                <span class="metadata-value">${defect.assigned_team}</span>
              </div>
            </div>
          </div>
          
          <div class="analysis-section">
            <h3>Description</h3>
            <p style="color: var(--color-text-secondary);">${defect.description}</p>
          </div>
          
          <div class="analysis-section">
            <h3>Action Items &amp; Recommendations</h3>
            <div class="action-items">
              <div class="action-item">
                <span style="font-size: var(--font-size-lg);">âš ï¸</span>
                <span>${defect.recommendations}</span>
              </div>
              <div class="action-item">
                <span style="font-size: var(--font-size-lg);">ðŸ‘¥</span>
                <span>Assigned to: ${defect.assigned_team}</span>
              </div>
              <div class="action-item">
                <span style="font-size: var(--font-size-lg);">ðŸ“…</span>
                <span>Schedule repair within 48 hours for critical defects</span>
              </div>
            </div>
          </div>
          
          <div class="analysis-section">
            <h3>Historical Comparison</h3>
            <p style="color: var(--color-text-secondary); font-size: var(--font-size-sm);">This is the first inspection of this column. Future inspections will show progression analysis here.</p>
          </div>
        `;
        
        panel.classList.add('active');
      }

      function closeDefectAnalysis() {
        document.getElementById('defect-analysis-panel').classList.remove('active');
      }

      // Filter Functions
      function applyFilters() {
        const typeFilter = document.getElementById('filter-type').value;
        const severityFilter = document.getElementById('filter-severity').value;
        const statusFilter = document.getElementById('filter-status').value;
        
        // In a real implementation, this would filter the defect list
        console.log('Applying filters:', { typeFilter, severityFilter, statusFilter });
      }

      function toggleHeatmap() {
        const checkbox = document.getElementById('heatmap-toggle');
        const diagram = document.getElementById('tray-diagram');
        
        if (checkbox.checked) {
          diagram.style.background = 'radial-gradient(circle at 45% 55%, rgba(192, 21, 47, 0.3), rgba(168, 75, 47, 0.2), rgba(33, 128, 141, 0.1))';
        } else {
          diagram.style.background = 'var(--color-bg-1)';
        }
      }

      // Utility Functions
      function showProgressTracker() {
        alert('Progress Tracker: All inspection phases are displayed in the sidebar. Repair Scheduling is currently 35% complete.');
      }

      function exportReport() {
        alert('Exporting PDF report for drum DRUM-VES-01. Report includes all inspection data, defect images, and repair recommendations.');
      }

      // Initialize on load
      document.addEventListener('DOMContentLoaded', initializeDashboard);
    </script>
  </body>
  </html>
